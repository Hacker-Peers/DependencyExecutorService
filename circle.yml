machine:
  java:
    version: oraclejdk8
  post:
    - echo $PGP_KEY | base64 --decode > ~/sec_key.gpg
    - gpg --import --allow-secret-key-import ~/sec_key.gpg
    - rm ~/sec_key.gpg
    - mkdir -p ~/.gradle
    - echo "signing.keyId=$PGP_KEY_ID" >> ~/.gradle/gradle.properties
    - echo "signing.password=$PGP_PASSWORD" >> ~/.gradle/gradle.properties
    - echo "signing.secretKeyRingFile=$HOME/.gnupg/secring.gpg" >> ~/.gradle/gradle.properties
    - echo "ossrhUsername=$OSSRH_USERNAME" >> ~/.gradle/gradle.properties
    - echo "ossrhPassword=$OSSRH_PASSWORD" >> ~/.gradle/gradle.properties
dependencies:
  pre:
    - chmod +x gradlew
  post:
    - if [ -e ./gradlew ]; then alias gradle=./gradlew;fi
test:
  pre:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - mkdir -p $CIRCLE_TEST_REPORTS/junit-html/
    - mkdir -p $CIRCLE_ARTIFACTS/libs/
  override:
    - gradle clean test jacocoTestReport coveralls
  post:
    - gradle build
#    - find . # Listing all folder structure
    - find . -type f -regex ".*/build/test-results/test/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;
    - cp -r ./build/reports/tests $CIRCLE_TEST_REPORTS/junit-html/
    - cp -r ./build/libs/* $CIRCLE_ARTIFACTS/libs
deployment:
  master:
    branch: master
    commands:
      - gradle clean test uploadArchives